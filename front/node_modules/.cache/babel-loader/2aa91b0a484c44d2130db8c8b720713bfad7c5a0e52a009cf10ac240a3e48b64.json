{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/g702306/Desktop/testy000/appliomm/E--commerce/pfa/front/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/Users/g702306/Desktop/testy000/appliomm/E--commerce/pfa/front/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.regexp.test.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport TopHeader from \"@/components/Common/TopHeader.vue\";\nimport MyFooter from \"@/components/Common/MyFooter.vue\";\nimport AuthenticationService from \"@/services/AuthenticationService.js\";\nexport default {\n  name: \"ResetPassword\",\n  components: {\n    TopHeader: TopHeader,\n    MyFooter: MyFooter\n  },\n  data: function data() {\n    return {\n      userId: null,\n      emailResetPassword: null,\n      mailSent: false,\n      name: null,\n      email: null,\n      newPassword: null,\n      formatPassword: /^[a-zA-z0-9]{8,32}$/,\n      confirmPassword: null,\n      tokenValidate: true\n    };\n  },\n  computed: {\n    newPasswordValidation: function newPasswordValidation() {\n      if (this.newPassword == null) return null;else if (!this.formatPassword.test(this.newPassword)) return false;else return true;\n    },\n    confirmPasswordValidation: function confirmPasswordValidation() {\n      if (this.confirmPassword == null) return null;else if (this.confirmPassword != this.newPassword || !this.formatPassword.test(this.confirmPassword)) return false;else return true;\n    }\n  },\n  mounted: function mounted() {\n    var _this = this;\n    return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      var token, user;\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            token = _this.$route.params.token;\n            _context.prev = 1;\n            _context.next = 4;\n            return AuthenticationService.verifyPasswordToken(token);\n          case 4:\n            user = _context.sent.data;\n            _this.userId = user.id;\n            _this.name = user.firstName + \" \" + user.lastName;\n            _this.email = user.email;\n            _context.next = 14;\n            break;\n          case 10:\n            _context.prev = 10;\n            _context.t0 = _context[\"catch\"](1);\n            _this.tokenValidate = false;\n            console.log(_context.t0.response.data.error);\n          case 14:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee, null, [[1, 10]]);\n    }))();\n  },\n  methods: {\n    passwordReset: function passwordReset() {\n      var _this2 = this;\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var response;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!(!_this2.newPasswordValidation || !_this2.confirmPasswordValidation)) {\n                _context2.next = 2;\n                break;\n              }\n              return _context2.abrupt(\"return\");\n            case 2:\n              _context2.prev = 2;\n              _this2.$bvToast.toast(\"Password has changed successfully\", {\n                title: \"Password has changed successfully\",\n                variant: \"success\",\n                toaster: \"b-toaster-top-center\",\n                noCloseButton: false,\n                solid: true\n              });\n              _context2.next = 6;\n              return AuthenticationService.resetPassword({\n                id: _this2.userId,\n                email: _this2.email,\n                name: _this2.name,\n                password: _this2.newPassword\n              });\n            case 6:\n              _context2.next = 11;\n              break;\n            case 8:\n              _context2.prev = 8;\n              _context2.t0 = _context2[\"catch\"](2);\n              console.log(_context2.t0.response.data.error);\n            case 11:\n              _context2.prev = 11;\n              _context2.next = 14;\n              return AuthenticationService.login({\n                email: _this2.email,\n                password: _this2.newPassword\n              });\n            case 14:\n              response = _context2.sent;\n              console.log(response.data.token);\n              _this2.$store.dispatch(\"CurrentUser/setToken\", response.data.token);\n              _this2.$store.dispatch(\"CurrentUser/setUser\", response.data.user);\n              _this2.$store.dispatch(\"Wishlist/setWishlist\");\n              _this2.$router.push({\n                path: \"/\"\n              });\n              _context2.next = 25;\n              break;\n            case 22:\n              _context2.prev = 22;\n              _context2.t1 = _context2[\"catch\"](11);\n              console.log(_context2.t1.response.data.error);\n            case 25:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, null, [[2, 8], [11, 22]]);\n      }))();\n    }\n  }\n};","map":{"version":3,"names":["TopHeader","MyFooter","AuthenticationService","name","components","data","userId","emailResetPassword","mailSent","email","newPassword","formatPassword","confirmPassword","tokenValidate","computed","newPasswordValidation","test","confirmPasswordValidation","mounted","_this","_asyncToGenerator","_regeneratorRuntime","mark","_callee","token","user","wrap","_callee$","_context","prev","next","$route","params","verifyPasswordToken","sent","id","firstName","lastName","t0","console","log","response","error","stop","methods","passwordReset","_this2","_callee2","_callee2$","_context2","abrupt","$bvToast","toast","title","variant","toaster","noCloseButton","solid","resetPassword","password","login","$store","dispatch","$router","push","path","t1"],"sources":["src/views/User/ResetPassword.vue"],"sourcesContent":["<template>\r\n    <div>\r\n      <TopHeader />\r\n      <b-container class=\"mt-5\">\r\n        <b-row class=\"ml-5\">\r\n          <b-col cols=\"10\" md=\"8\" lg=\"6\">\r\n            <b-card v-if=\"!tokenValidate\">\r\n              <h5 class=\"text-center\"><strong>réinitialisez votre mot de passe</strong></h5>\r\n              <b-alert class=\"mt-4\" variant=\"warning\" show>\r\n                <small>\r\n                  Il semble que vous ayez cliqué sur un lien de réinitialisation de mot de passe invalide.\r\n                  <br />\r\n                  <b-link to=\"/login\">\r\n                    Connectez-vous ici\r\n                    <b-icon icon=\"arrow-right\" />\r\n                  </b-link>\r\n                </small>\r\n              </b-alert>\r\n            </b-card>\r\n  \r\n            <b-card v-if=\"tokenValidate\" style=\"color: #001e5f\">\r\n              <h4 class=\"font-weight-bold\">Changer le mot de passe pour {{ email }}</h4>\r\n              <b-form @submit.stop.prevent=\"passwordReset\" class=\"mt-4\">\r\n                <b-form-group\r\n                  class=\"font-weight-bold\"\r\n                  id=\"input-group-password\"\r\n                  label=\"Nouveau mot de passe\"\r\n                  label-for=\"input-password\"\r\n                >\r\n                  <b-form-input\r\n                    v-model=\"newPassword\"\r\n                    id=\"input-password\"\r\n                    type=\"password\"\r\n                    required\r\n                    :state=\"newPasswordValidation\"\r\n                  />\r\n                  <b-form-invalid-feedback\r\n                    v-if=\"newPassword\"\r\n                    :state=\"newPasswordValidation\"\r\n                  >\r\n\r\n                  Votre mot de passe peut être composé de 8 à 32 caractères, contenir des lettres,\r\n                    chiffres et ne doit pas contenir d'espace.\r\n                  </b-form-invalid-feedback>\r\n                </b-form-group>\r\n  \r\n                <b-form-group\r\n                  class=\"font-weight-bold\"\r\n                  id=\"input-group-2-password\"\r\n                  label=\"Confirmez le mot de passe\"\r\n                  label-for=\"input-2-password\"\r\n                >\r\n                  <b-form-input\r\n                    v-model=\"confirmPassword\"\r\n                    id=\"input-2-password\"\r\n                    type=\"password\"\r\n                    required\r\n                    :state=\"confirmPasswordValidation\"\r\n                  />\r\n                  <b-form-invalid-feedback\r\n                    v-if=\"confirmPassword\"\r\n                    :state=\"confirmPasswordValidation\"\r\n                  >\r\n                    Le mot de passe ne correspond pas\r\n                  </b-form-invalid-feedback>\r\n                </b-form-group>\r\n                <b-row>\r\n                  <b-col cols=\"6\">\r\n                    <b-button\r\n                      class=\"p-2 mt-2 font-weight-bold\"\r\n                      block\r\n                      type=\"submit\"\r\n                      variant=\"warning\"\r\n                    >\r\n                      Submit\r\n                    </b-button>\r\n                  </b-col>\r\n                </b-row>\r\n              </b-form>\r\n            </b-card>\r\n          </b-col>\r\n        </b-row>\r\n      </b-container>\r\n      <MyFooter class=\"mt-5\" />\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  import TopHeader from \"@/components/Common/TopHeader.vue\";\r\n  import MyFooter from \"@/components/Common/MyFooter.vue\";\r\n  import AuthenticationService from \"@/services/AuthenticationService.js\";\r\n  export default {\r\n    name: \"ResetPassword\",\r\n    components: {\r\n      TopHeader,\r\n      MyFooter,\r\n    },\r\n    data() {\r\n      return {\r\n        userId: null,\r\n        emailResetPassword: null,\r\n        mailSent: false,\r\n        name: null,\r\n        email: null,\r\n        newPassword: null,\r\n        formatPassword: /^[a-zA-z0-9]{8,32}$/,\r\n        confirmPassword: null,\r\n        tokenValidate: true,\r\n      };\r\n    },\r\n    computed: {\r\n      newPasswordValidation() {\r\n        if (this.newPassword == null) return null;\r\n        else if (!this.formatPassword.test(this.newPassword)) return false;\r\n        else return true;\r\n      },\r\n      confirmPasswordValidation() {\r\n        if (this.confirmPassword == null) return null;\r\n        else if (\r\n          this.confirmPassword != this.newPassword ||\r\n          !this.formatPassword.test(this.confirmPassword)\r\n        )\r\n          return false;\r\n        else return true;\r\n      },\r\n    },\r\n    async mounted() {\r\n      const token = this.$route.params.token;\r\n      try {\r\n       \r\n        var user = (await AuthenticationService.verifyPasswordToken(token)).data;\r\n        \r\n        this.userId = user.id;\r\n        this.name = user.firstName + \" \" + user.lastName;\r\n        this.email = user.email;\r\n      } catch (error) {\r\n        this.tokenValidate = false;\r\n        console.log(error.response.data.error);\r\n      }\r\n    },\r\n    methods: {\r\n      async passwordReset() {\r\n        if (!this.newPasswordValidation || !this.confirmPasswordValidation)\r\n          return;\r\n        try {\r\n          this.$bvToast.toast(\"Password has changed successfully\", {\r\n            title: \"Password has changed successfully\",\r\n            variant: \"success\",\r\n            toaster: \"b-toaster-top-center\",\r\n            noCloseButton: false,\r\n            solid: true,\r\n          });\r\n          await AuthenticationService.resetPassword({\r\n            \r\n            id: this.userId,\r\n            email: this.email,\r\n            name: this.name,\r\n            password: this.newPassword,\r\n          });\r\n        } catch (error) {\r\n          console.log(error.response.data.error);\r\n        }\r\n        try {\r\n          const response = await AuthenticationService.login({\r\n            email: this.email,\r\n            password: this.newPassword,\r\n          });\r\n          console.log(response.data.token);\r\n          this.$store.dispatch(\"CurrentUser/setToken\", response.data.token);\r\n          this.$store.dispatch(\"CurrentUser/setUser\", response.data.user);\r\n          this.$store.dispatch(\"Wishlist/setWishlist\");\r\n          this.$router.push({ path: \"/\" });\r\n        } catch (error) {\r\n          console.log(error.response.data.error);\r\n        }\r\n      },\r\n    },\r\n  };\r\n  </script>\r\n  \r\n  <style scoped lang=\"scss\">\r\n  #layoutAuthentication_footer {\r\n    margin-top: 120px;\r\n  }\r\n  .error {\r\n    color: red;\r\n  }\r\n  .abbr:hover,\r\n  .abbr:active {\r\n    color: #4caf50;\r\n    color: #19689c;\r\n  }\r\n  .abbr:active,\r\n  .abbr:hover {\r\n    outline-width: 0;\r\n  }\r\n  .logo {\r\n    font-family: fontawesome;\r\n    text-decoration: none;\r\n    line-height: 1;\r\n    -webkit-font-smoothing: antialiased;\r\n    -moz-osx-font-smoothing: grayscale;\r\n    font-size: 30px;\r\n    letter-spacing: 3px;\r\n    color: #000000;\r\n    display: block;\r\n    top: 17px;\r\n  }\r\n  // a {\r\n  //     color: inherit;\r\n  // }\r\n  .abbr {\r\n    background-color: transparent;\r\n  }\r\n  #layoutAuthentication {\r\n    background-color: rgb(255, 255, 255);\r\n  }\r\n  </style>\r\n  "],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}