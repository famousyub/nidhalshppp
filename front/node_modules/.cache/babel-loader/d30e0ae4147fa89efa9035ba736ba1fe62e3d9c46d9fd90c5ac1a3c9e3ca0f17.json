{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/g702306/Desktop/testy000/appliomm/E--commerce/pfa/front/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/Users/g702306/Desktop/testy000/appliomm/E--commerce/pfa/front/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport AuthenticationService from \"@/services/AuthenticationService.js\";\nimport UserService from \"@/services/UserService.js\";\nimport ReviewService from \"@/services/ReviewService.js\";\nexport default {\n  name: \"UAccount\",\n  components: {},\n  data: function data() {\n    return {\n      userId: 0,\n      user: {},\n      admin: false,\n      modalAlert: null,\n      deleteAccountError: \"\",\n      currentPassword: null\n    };\n  },\n  mounted: function mounted() {\n    this.userId = this.$store.state.CurrentUser.userId;\n    this.user = this.$store.state.CurrentUser.user;\n    this.admin = this.$store.state.CurrentUser.admin;\n  },\n  methods: {\n    focusPasswordField: function focusPasswordField() {\n      this.$refs.passwordField.focus();\n    },\n    deleteAccount: function deleteAccount() {\n      var _this = this;\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var correctPassword, reviewList, i;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              correctPassword = false;\n              _context.prev = 1;\n              _context.next = 4;\n              return AuthenticationService.verifyPassword(_this.currentPassword);\n            case 4:\n              correctPassword = _context.sent.data.correctPassword;\n              _context.next = 12;\n              break;\n            case 7:\n              _context.prev = 7;\n              _context.t0 = _context[\"catch\"](1);\n              _this.modalAlert = true;\n              _this.deleteAccountError = _context.t0.response.data.error;\n              console.log(_context.t0.response.data.error);\n            case 12:\n              if (!correctPassword) {\n                _context.next = 43;\n                break;\n              }\n              reviewList = [];\n              _context.prev = 14;\n              _context.next = 17;\n              return ReviewService.getUsersReviewList(_this.userId);\n            case 17:\n              reviewList = _context.sent.data;\n              _context.next = 23;\n              break;\n            case 20:\n              _context.prev = 20;\n              _context.t1 = _context[\"catch\"](14);\n              console.log(_context.t1.response.data.error);\n            case 23:\n              _context.t2 = _regeneratorRuntime().keys(reviewList);\n            case 24:\n              if ((_context.t3 = _context.t2()).done) {\n                _context.next = 30;\n                break;\n              }\n              i = _context.t3.value;\n              _context.next = 28;\n              return _this.$store.dispatch(\"Review/deleteReview\", reviewList[i]);\n            case 28:\n              _context.next = 24;\n              break;\n            case 30:\n              _context.prev = 30;\n              _context.next = 33;\n              return UserService.deleteAccount(_this.userId);\n            case 33:\n              _context.next = 39;\n              break;\n            case 35:\n              _context.prev = 35;\n              _context.t4 = _context[\"catch\"](30);\n              _this.modalAlert = true;\n              _this.deleteAccountError = _context.t4.response.data.error;\n            case 39:\n              _this.$store.dispatch(\"CurrentUser/setToken\", \"\");\n              _this.$store.dispatch(\"CurrentUser/setUser\", {});\n              _this.$store.dispatch(\"Wishlist/clearWishlist\");\n              _this.$router.push({\n                path: \"/\"\n              });\n            case 43:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, null, [[1, 7], [14, 20], [30, 35]]);\n      }))();\n    }\n  },\n  computed: {}\n};","map":{"version":3,"names":["AuthenticationService","UserService","ReviewService","name","components","data","userId","user","admin","modalAlert","deleteAccountError","currentPassword","mounted","$store","state","CurrentUser","methods","focusPasswordField","$refs","passwordField","focus","deleteAccount","_this","_asyncToGenerator","_regeneratorRuntime","mark","_callee","correctPassword","reviewList","i","wrap","_callee$","_context","prev","next","verifyPassword","sent","t0","response","error","console","log","getUsersReviewList","t1","t2","keys","t3","done","value","dispatch","t4","$router","push","path","stop","computed"],"sources":["src/components/User/Profile/UAccount.vue"],"sourcesContent":["<template>\r\n    <div>\r\n      <b-row>\r\n        <b-col>\r\n          <h5>Profile</h5>\r\n          <hr />\r\n        </b-col>\r\n      </b-row>\r\n      <div>\r\n        <div v-if=\"admin\">\r\n          Role\r\n          <br />\r\n          <b-button class=\"mt-2\" :variant=\"user.variant\">\r\n            {{ user.userType }}\r\n          </b-button>\r\n          <hr />\r\n        </div>\r\n        <div>\r\n          <b-button\r\n            v-b-modal.delete-account-confirmation\r\n            variant=\"outline-danger\"\r\n          >\r\n            Fermer mon compte\r\n          </b-button>\r\n          <br />\r\n          <p class=\"mt-2\">\r\n            Une fois votre compte supprimé, vous ne pourrez plus le rétablir.\r\n          </p>\r\n        </div>\r\n      </div>\r\n      <b-modal\r\n        @shown=\"focusPasswordField\"\r\n        hide-footer\r\n        id=\"delete-account-confirmation\"\r\n      >\r\n        <template #modal-title> Es-tu sûr de vouloir faire ça? </template>\r\n        <p>Nous supprimerons également toutes vos activités de notre serveur.</p>\r\n  \r\n        <label for=\"input-password\">\r\n          Pour être sûr, veuillez entrer votre\r\n          <strong>Mot de passe actuel</strong>\r\n        </label>\r\n        <b-form-input\r\n          type=\"password\"\r\n          @keyup=\"modalAlert = false\"\r\n          ref=\"passwordField\"\r\n          v-model=\"currentPassword\"\r\n          id=\"input-password\"\r\n        />\r\n        <b-alert :show=\"modalAlert\" variant=\"primary\" class=\"my-2 p-1 pl-2\">\r\n          {{ deleteAccountError }}\r\n        </b-alert>\r\n        <b-row class=\"mt-3\">\r\n          <b-col cols=\"4\" />\r\n          <b-col cols=\"4\">\r\n            <b-button\r\n              @click=\"$bvModal.hide('delete-account-confirmation')\"\r\n              block\r\n              variant=\"warning\"\r\n            >\r\n              Annuler\r\n            </b-button>\r\n          </b-col>\r\n          <b-col cols=\"4\">\r\n            <b-button block @click=\"deleteAccount\" variant=\"danger\">\r\n              Supprimer Compte\r\n            </b-button>\r\n          </b-col>\r\n        </b-row>\r\n      </b-modal>\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  import AuthenticationService from \"@/services/AuthenticationService.js\";\r\n  import UserService from \"@/services/UserService.js\";\r\n  import ReviewService from \"@/services/ReviewService.js\";\r\n  export default {\r\n    name: \"UAccount\",\r\n    components: {},\r\n    data() {\r\n      return {\r\n        userId: 0,\r\n        user: {},\r\n        admin: false,\r\n        modalAlert: null,\r\n        deleteAccountError: \"\",\r\n        currentPassword: null,\r\n      };\r\n    },\r\n    mounted() {\r\n      this.userId = this.$store.state.CurrentUser.userId;\r\n      this.user = this.$store.state.CurrentUser.user;\r\n      this.admin = this.$store.state.CurrentUser.admin;\r\n    },\r\n    methods: {\r\n      focusPasswordField() {\r\n        this.$refs.passwordField.focus();\r\n      },\r\n      async deleteAccount() {\r\n        var correctPassword = false;\r\n        try {\r\n          correctPassword = (\r\n            await AuthenticationService.verifyPassword(this.currentPassword)\r\n          ).data.correctPassword;\r\n        } catch (error) {\r\n          this.modalAlert = true;\r\n          this.deleteAccountError = error.response.data.error;\r\n          console.log(error.response.data.error);\r\n        }\r\n        if (correctPassword) {\r\n          var reviewList = [];\r\n          try {\r\n            reviewList = (await ReviewService.getUsersReviewList(this.userId))\r\n              .data;\r\n          } catch (error) {\r\n            console.log(error.response.data.error);\r\n          }\r\n          var i;\r\n          for (i in reviewList) {\r\n            await this.$store.dispatch(\"Review/deleteReview\", reviewList[i]);\r\n          }\r\n          try {\r\n            await UserService.deleteAccount(this.userId);\r\n          } catch (error) {\r\n            this.modalAlert = true;\r\n            this.deleteAccountError = error.response.data.error;\r\n          }\r\n          this.$store.dispatch(\"CurrentUser/setToken\", \"\");\r\n          this.$store.dispatch(\"CurrentUser/setUser\", {});\r\n          this.$store.dispatch(\"Wishlist/clearWishlist\");\r\n          this.$router.push({ path: \"/\" });\r\n        }\r\n      },\r\n    },\r\n    computed: {},\r\n  };\r\n  </script>\r\n  \r\n  <style lang=\"scss\" scoped></style>\r\n  "],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}