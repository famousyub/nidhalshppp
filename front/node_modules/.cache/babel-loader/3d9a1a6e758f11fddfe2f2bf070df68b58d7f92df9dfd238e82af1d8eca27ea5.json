{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/g702306/Desktop/testy000/appliomm/E--commerce/pfa/front/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/Users/g702306/Desktop/testy000/appliomm/E--commerce/pfa/front/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport AuthenticationService from \"@/services/AuthenticationService.js\";\nimport TopHeader from \"@/components/Common/TopHeader.vue\";\nimport MyFooter from \"@/components/Common/MyFooter.vue\";\nexport default {\n  name: \"UserVerify\",\n  components: {\n    TopHeader: TopHeader,\n    MyFooter: MyFooter\n  },\n  data: function data() {\n    return {\n      userId: 0,\n      userEmail: \"\",\n      registerTokenValidation: null,\n      codeVerificationMessage: \"\",\n      registerToken: \"\"\n    };\n  },\n  computed: {},\n  mounted: function mounted() {\n    var _this = this;\n    return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            _this.userId = _this.$store.state.CurrentUser.newUserId;\n            _this.userEmail = _this.$store.state.CurrentUser.newUserEmail;\n          case 2:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee);\n    }))();\n  },\n  methods: {\n    tryAgain: function tryAgain() {\n      var _this2 = this;\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var user;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 3;\n              return AuthenticationService.checkRegsToken({\n                email: _this2.userEmail,\n                password: _this2.$store.state.CurrentUser.newUserPassword\n              });\n            case 3:\n              user = _context2.sent.data;\n              if (user.verificationStatus) {\n                _this2.$router.push({\n                  path: \"/login\"\n                });\n              } else {\n                window.location.reload();\n              }\n              _context2.next = 10;\n              break;\n            case 7:\n              _context2.prev = 7;\n              _context2.t0 = _context2[\"catch\"](0);\n              console.log(_context2.t0.response.data.error);\n            case 10:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, null, [[0, 7]]);\n      }))();\n    },\n    verifyRegsToken: function verifyRegsToken() {\n      var _this3 = this;\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        var user;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              _context3.next = 3;\n              return AuthenticationService.verifyRegsToken({\n                userId: _this3.userId,\n                registerToken: _this3.registerToken\n              });\n            case 3:\n              user = _context3.sent.data;\n              _context3.next = 10;\n              break;\n            case 6:\n              _context3.prev = 6;\n              _context3.t0 = _context3[\"catch\"](0);\n              _this3.registerTokenValidation = false;\n              _this3.codeVerificationMessage = _context3.t0.response.data.error;\n            case 10:\n              if (!user) {\n                _context3.next = 25;\n                break;\n              }\n              _context3.prev = 11;\n              _context3.next = 14;\n              return AuthenticationService.resetRegsToken({\n                id: user.user.id,\n                email: user.user.email,\n                name: user.user.firstName + \" \" + user.user.lastName\n              });\n            case 14:\n              _this3.$store.dispatch(\"CurrentUser/setToken\", user.token);\n              _this3.$store.dispatch(\"CurrentUser/setUser\", user.user);\n              _this3.$store.dispatch(\"Wishlist/setWishlist\");\n              _this3.$store.dispatch(\"CurrentUser/setNewUserId\", 0);\n              _this3.$store.dispatch(\"CurrentUser/setNewUserEmail\", \"\");\n              _this3.$router.push({\n                path: \"/\"\n              });\n              _context3.next = 25;\n              break;\n            case 22:\n              _context3.prev = 22;\n              _context3.t1 = _context3[\"catch\"](11);\n              console.log(_context3.t1.response.data.error);\n            case 25:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, null, [[0, 6], [11, 22]]);\n      }))();\n    }\n  }\n};","map":{"version":3,"names":["AuthenticationService","TopHeader","MyFooter","name","components","data","userId","userEmail","registerTokenValidation","codeVerificationMessage","registerToken","computed","mounted","_this","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","$store","state","CurrentUser","newUserId","newUserEmail","stop","methods","tryAgain","_this2","_callee2","user","_callee2$","_context2","checkRegsToken","email","password","newUserPassword","sent","verificationStatus","$router","push","path","window","location","reload","t0","console","log","response","error","verifyRegsToken","_this3","_callee3","_callee3$","_context3","resetRegsToken","id","firstName","lastName","dispatch","token","t1"],"sources":["src/views/User/UserVerify.vue"],"sourcesContent":["<template>\r\n    <div>\r\n      <TopHeader />\r\n      <b-container class=\"mt-5\">\r\n        <b-row>\r\n          <b-col cols=\"6\">\r\n            <b-card v-if=\"userId == 0\">\r\n              <h5 class=\"text-center\"><strong>vérification de l'E-mail</strong></h5>\r\n              <b-alert class=\"mt-4\" variant=\"warning\" show>\r\n                <small>\r\n                  Veuillez essayer de\r\n                  <b-link to=\"/register\">Créez votre compte</b-link>\r\n                  first.\r\n                </small>\r\n              </b-alert>\r\n            </b-card>\r\n  \r\n            <b-card\r\n              style=\"color: #001e5f\"\r\n              v-if=\"userId != 0\"\r\n              border-variant=\"info\"\r\n              header=\"email vérification\"\r\n              header-bg-variant=\"info\"\r\n              header-text-variant=\"white\"\r\n              header-class=\"text-center\"\r\n            >\r\n              <b-form @submit.stop.prevent=\"verifyRegsToken\">\r\n                <b-form-group>\r\n                  <label for=\"input-verification-code\">\r\n                      Entrez le code que nous envoyons à <strong>{{ userEmail }}.</strong> If\r\n                    il n'apparaît pas au bout de quelques minutes, vérifiez votre dossier spam\r\n                  </label>\r\n                  <b-form-input\r\n                    id=\"input-verification-code\"\r\n                    v-model=\"registerToken\"\r\n                    required\r\n                    :state=\"registerTokenValidation\"\r\n                  />\r\n                  <b-form-invalid-feedback :state=\"registerTokenValidation\">\r\n                    {{ codeVerificationMessage }}\r\n                  </b-form-invalid-feedback>\r\n                </b-form-group>\r\n                <b-button type=\"submit\" variant=\"success\"> Submit </b-button>\r\n                <div class=\"mt-4\">\r\n                  vous pouvez renvoyer le code de vérification si vous n'avez pas reçu\r\n                  le courriel.\r\n                  <br />\r\n                  <b-button\r\n                    class=\"mt-2\"\r\n                    size=\"sm\"\r\n                    variant=\"info\"\r\n                    @click=\"tryAgain\"\r\n                  >\r\n                    Ré-envoyer l'email\r\n                  </b-button>\r\n                </div>\r\n              </b-form>\r\n            </b-card>\r\n          </b-col>\r\n        </b-row>\r\n      </b-container>\r\n      <MyFooter class=\"mt-5\" />\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  import AuthenticationService from \"@/services/AuthenticationService.js\";\r\n  import TopHeader from \"@/components/Common/TopHeader.vue\";\r\n  import MyFooter from \"@/components/Common/MyFooter.vue\";\r\n  export default {\r\n    name: \"UserVerify\",\r\n    components: {\r\n      TopHeader,\r\n      MyFooter,\r\n    },\r\n    data() {\r\n      return {\r\n        userId: 0,\r\n        userEmail: \"\",\r\n        registerTokenValidation: null,\r\n        codeVerificationMessage: \"\",\r\n        registerToken: \"\",\r\n      };\r\n    },\r\n    computed: {},\r\n    async mounted() {\r\n      this.userId = this.$store.state.CurrentUser.newUserId;\r\n      this.userEmail = this.$store.state.CurrentUser.newUserEmail;\r\n    },\r\n    methods: {\r\n      async tryAgain() {\r\n        try {\r\n          const user = (\r\n            await AuthenticationService.checkRegsToken({\r\n              email: this.userEmail,\r\n              password: this.$store.state.CurrentUser.newUserPassword,\r\n            })\r\n          ).data;\r\n          if (user.verificationStatus) {\r\n            this.$router.push({ path: \"/login\" });\r\n          } else {\r\n            window.location.reload();\r\n          }\r\n        } catch (error) {\r\n          console.log(error.response.data.error);\r\n        }\r\n      },\r\n      async verifyRegsToken() {\r\n        var user;\r\n        try {\r\n          user = (\r\n            await AuthenticationService.verifyRegsToken({\r\n              userId: this.userId,\r\n              registerToken: this.registerToken,\r\n            })\r\n          ).data;\r\n        } catch (error) {\r\n          this.registerTokenValidation = false;\r\n          this.codeVerificationMessage = error.response.data.error;\r\n        }\r\n        if (user) {\r\n          try {\r\n            await AuthenticationService.resetRegsToken({\r\n              id: user.user.id,\r\n              email: user.user.email,\r\n              name: user.user.firstName + \" \" + user.user.lastName,\r\n            });\r\n            this.$store.dispatch(\"CurrentUser/setToken\", user.token);\r\n            this.$store.dispatch(\"CurrentUser/setUser\", user.user);\r\n            this.$store.dispatch(\"Wishlist/setWishlist\");\r\n            this.$store.dispatch(\"CurrentUser/setNewUserId\", 0);\r\n            this.$store.dispatch(\"CurrentUser/setNewUserEmail\", \"\");\r\n            this.$router.push({ path: \"/\" });\r\n          } catch (error) {\r\n            console.log(error.response.data.error);\r\n          }\r\n        }\r\n      },\r\n    },\r\n  };\r\n  </script>\r\n  \r\n  <style lang=\"scss\" scoped></style>\r\n  "],"mappings":";;;AAkEA,OAAAA,qBAAA;AACA,OAAAC,SAAA;AACA,OAAAC,QAAA;AACA;EACAC,IAAA;EACAC,UAAA;IACAH,SAAA,EAAAA,SAAA;IACAC,QAAA,EAAAA;EACA;EACAG,IAAA,WAAAA,KAAA;IACA;MACAC,MAAA;MACAC,SAAA;MACAC,uBAAA;MACAC,uBAAA;MACAC,aAAA;IACA;EACA;EACAC,QAAA;EACAC,OAAA,WAAAA,QAAA;IAAA,IAAAC,KAAA;IAAA,OAAAC,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,UAAAC,QAAA;MAAA,OAAAF,mBAAA,GAAAG,IAAA,UAAAC,SAAAC,QAAA;QAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;UAAA;YACAT,KAAA,CAAAP,MAAA,GAAAO,KAAA,CAAAU,MAAA,CAAAC,KAAA,CAAAC,WAAA,CAAAC,SAAA;YACAb,KAAA,CAAAN,SAAA,GAAAM,KAAA,CAAAU,MAAA,CAAAC,KAAA,CAAAC,WAAA,CAAAE,YAAA;UAAA;UAAA;YAAA,OAAAP,QAAA,CAAAQ,IAAA;QAAA;MAAA,GAAAX,OAAA;IAAA;EACA;EACAY,OAAA;IACAC,QAAA,WAAAA,SAAA;MAAA,IAAAC,MAAA;MAAA,OAAAjB,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,UAAAgB,SAAA;QAAA,IAAAC,IAAA;QAAA,OAAAlB,mBAAA,GAAAG,IAAA,UAAAgB,UAAAC,SAAA;UAAA,kBAAAA,SAAA,CAAAd,IAAA,GAAAc,SAAA,CAAAb,IAAA;YAAA;cAAAa,SAAA,CAAAd,IAAA;cAAAc,SAAA,CAAAb,IAAA;cAAA,OAGAtB,qBAAA,CAAAoC,cAAA;gBACAC,KAAA,EAAAN,MAAA,CAAAxB,SAAA;gBACA+B,QAAA,EAAAP,MAAA,CAAAR,MAAA,CAAAC,KAAA,CAAAC,WAAA,CAAAc;cACA;YAAA;cAJAN,IAAA,GAAAE,SAAA,CAAAK,IAAA,CAKAnC,IAAA;cACA,IAAA4B,IAAA,CAAAQ,kBAAA;gBACAV,MAAA,CAAAW,OAAA,CAAAC,IAAA;kBAAAC,IAAA;gBAAA;cACA;gBACAC,MAAA,CAAAC,QAAA,CAAAC,MAAA;cACA;cAAAZ,SAAA,CAAAb,IAAA;cAAA;YAAA;cAAAa,SAAA,CAAAd,IAAA;cAAAc,SAAA,CAAAa,EAAA,GAAAb,SAAA;cAEAc,OAAA,CAAAC,GAAA,CAAAf,SAAA,CAAAa,EAAA,CAAAG,QAAA,CAAA9C,IAAA,CAAA+C,KAAA;YAAA;YAAA;cAAA,OAAAjB,SAAA,CAAAP,IAAA;UAAA;QAAA,GAAAI,QAAA;MAAA;IAEA;IACAqB,eAAA,WAAAA,gBAAA;MAAA,IAAAC,MAAA;MAAA,OAAAxC,iBAAA,eAAAC,mBAAA,GAAAC,IAAA,UAAAuC,SAAA;QAAA,IAAAtB,IAAA;QAAA,OAAAlB,mBAAA,GAAAG,IAAA,UAAAsC,UAAAC,SAAA;UAAA,kBAAAA,SAAA,CAAApC,IAAA,GAAAoC,SAAA,CAAAnC,IAAA;YAAA;cAAAmC,SAAA,CAAApC,IAAA;cAAAoC,SAAA,CAAAnC,IAAA;cAAA,OAIAtB,qBAAA,CAAAqD,eAAA;gBACA/C,MAAA,EAAAgD,MAAA,CAAAhD,MAAA;gBACAI,aAAA,EAAA4C,MAAA,CAAA5C;cACA;YAAA;cAJAuB,IAAA,GAAAwB,SAAA,CAAAjB,IAAA,CAKAnC,IAAA;cAAAoD,SAAA,CAAAnC,IAAA;cAAA;YAAA;cAAAmC,SAAA,CAAApC,IAAA;cAAAoC,SAAA,CAAAT,EAAA,GAAAS,SAAA;cAEAH,MAAA,CAAA9C,uBAAA;cACA8C,MAAA,CAAA7C,uBAAA,GAAAgD,SAAA,CAAAT,EAAA,CAAAG,QAAA,CAAA9C,IAAA,CAAA+C,KAAA;YAAA;cAAA,KAEAnB,IAAA;gBAAAwB,SAAA,CAAAnC,IAAA;gBAAA;cAAA;cAAAmC,SAAA,CAAApC,IAAA;cAAAoC,SAAA,CAAAnC,IAAA;cAAA,OAEAtB,qBAAA,CAAA0D,cAAA;gBACAC,EAAA,EAAA1B,IAAA,CAAAA,IAAA,CAAA0B,EAAA;gBACAtB,KAAA,EAAAJ,IAAA,CAAAA,IAAA,CAAAI,KAAA;gBACAlC,IAAA,EAAA8B,IAAA,CAAAA,IAAA,CAAA2B,SAAA,SAAA3B,IAAA,CAAAA,IAAA,CAAA4B;cACA;YAAA;cACAP,MAAA,CAAA/B,MAAA,CAAAuC,QAAA,yBAAA7B,IAAA,CAAA8B,KAAA;cACAT,MAAA,CAAA/B,MAAA,CAAAuC,QAAA,wBAAA7B,IAAA,CAAAA,IAAA;cACAqB,MAAA,CAAA/B,MAAA,CAAAuC,QAAA;cACAR,MAAA,CAAA/B,MAAA,CAAAuC,QAAA;cACAR,MAAA,CAAA/B,MAAA,CAAAuC,QAAA;cACAR,MAAA,CAAAZ,OAAA,CAAAC,IAAA;gBAAAC,IAAA;cAAA;cAAAa,SAAA,CAAAnC,IAAA;cAAA;YAAA;cAAAmC,SAAA,CAAApC,IAAA;cAAAoC,SAAA,CAAAO,EAAA,GAAAP,SAAA;cAEAR,OAAA,CAAAC,GAAA,CAAAO,SAAA,CAAAO,EAAA,CAAAb,QAAA,CAAA9C,IAAA,CAAA+C,KAAA;YAAA;YAAA;cAAA,OAAAK,SAAA,CAAA7B,IAAA;UAAA;QAAA,GAAA2B,QAAA;MAAA;IAGA;EACA;AACA"},"metadata":{},"sourceType":"module","externalDependencies":[]}